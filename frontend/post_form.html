<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>글 작성/수정</title>
    <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="/index.html" class="nav-brand">MSA Project</a>
            <div class="nav-links">
                <a href="/board_list.html" class="nav-link">게시판</a>
                <a href="/blog_list.html" class="nav-link">블로그</a>
            </div>
            <div id="auth-links" class="nav-auth"></div>
        </div>
    </nav>
    <main class="container">
        <div class="form-container">
            <h1 id="form-title">새 글 작성</h1>
            <form id="post-form">
                <p id="error-message" style="color:red;"></p>
                <div>
                    <label for="title">제목:</label>
                    <input type="text" id="title" name="title" required>
                </div>
                <div>
                    <label for="content">내용:</label>
                    <textarea id="content" name="content" rows="10" required></textarea>
                </div>
                <div>
                    <label for="tags">태그 (쉼표로 구분):</label>
                    <input type="text" id="tags" name="tags">
                </div>
                <button type="submit">저장</button>
            </form>
        </div>
    </main>
<script>
const urlParams = new URLSearchParams(window.location.search);
const postId = urlParams.get('id');
const form = document.getElementById('post-form');
const errorEl = document.getElementById('error-message');
const formTitle = document.getElementById('form-title');

if (postId) {
    formTitle.innerText = "글 수정";
    fetch(`/api/board/posts/${postId}`)
        .then(res => res.json())
        .then(post => {
            document.getElementById('title').value = post.title;
            document.getElementById('content').value = post.content;
            document.getElementById('tags').value = post.tags || '';
        });
}

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    errorEl.innerText = '';
    const title = document.getElementById('title').value;
    const content = document.getElementById('content').value;
    const tags = document.getElementById('tags').value;
    const headers = { "Content-Type": "application/json" };
    const userId = localStorage.getItem("user_id");
    if (userId) headers["X-User-Id"] = userId;

    const method = postId ? 'PATCH' : 'POST';
    const url = postId ? `/api/board/posts/${postId}` : '/api/board/posts';
    const response = await fetch(url, {
        method,
        headers,
        body: JSON.stringify({ title, content, tags })
    });
    if (response.ok) {
        window.location.href = '/board_list.html';
    } else {
        const err = await response.json();
        errorEl.innerText = err.detail || "저장 실패";
    }
});
</script>
</body>
</html>